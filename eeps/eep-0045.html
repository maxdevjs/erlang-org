<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/erlang-org/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://erlang.github.io/erlang-org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0045 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0045 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://erlang.github.io/erlang-org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://erlang.github.io/erlang-org/blog.xml" />
    
    <link rel="stylesheet" href="/erlang-org/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/erlang-org/"><img
                    src="/erlang-org/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="post" action="https://duckduckgo.com/?kg=p"
                    onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' site:erlang.org'; return true;">
                    <input type="hidden" id="searchq" name="q" class="hidden" />
                    <input class="form-control me-2" id="searchfield" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Björn Gustavsson &lt;bjorn(at)erlang(dot)org&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Accepted/19.0 Proposal is to be implemented in OTP release 19.0</dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>27-Oct-2015</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>R19</dd>
                        
                        
                        <dt>Post-History:</dt>
                        <dd>29-Oct-2015, 09-Nov-2015, 11-Nov-2015, 16-Nov-2015</dd>
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                <h2 id="eep-45-new-macros-for-function-name-and-arity">EEP 45: New macros for function name and arity</h2>

<h1 id="abstract">Abstract</h1>

<p>This EEP proposes two new macros called <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and
<code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> that will return the name and arity, respectively, of
the current function.</p>

<h1 id="specification">Specification</h1>

<p>The new predefined macro <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> expands to the name of the
current function (as an atom).  The new predefined macro
<code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> expands to arity of the current function (as an
integer).  Example:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">a_function</span><span class="p">(_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="p">{</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span><span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">}.</span>
</code></pre></div></div>

<p>After preprocessing, the example will look like:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">a_function</span><span class="p">(_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="p">{</span><span class="n">a_function</span><span class="p">,</span><span class="mi">2</span><span class="p">}.</span>
</code></pre></div></div>

<p>The preprocessor will expand all other macros before expanding
the <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> macros. So if we have
this example:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">F</span><span class="p">,</span> <span class="n">a_function</span><span class="p">).</span>
<span class="o">?</span><span class="nv">F</span><span class="p">(_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="p">{</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span><span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">}.</span>
</code></pre></div></div>

<p>the preprocessor will first expand it to:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">a_function</span><span class="p">(_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="p">{</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span><span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">}.</span>
</code></pre></div></div>

<p>and then to:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">a_function</span><span class="p">(_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="p">{</span><span class="n">a_function</span><span class="p">,</span><span class="mi">2</span><span class="p">}.</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> macros can be used in any
form that starts with an atom followed by a left parenthesis (when
all other macros have been expanded).  The macros may be used even in
a function head.  Thus, the following example is legal (albeit not
very useful):</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">a</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>It will be expanded to:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">a</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> macros will also work in the
presence of other macros in the function head.  Example:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">__</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_).</span>
<span class="nf">b</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">,</span> <span class="o">?</span><span class="p">__)</span> <span class="o">-&gt;</span>
   <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>This code will first be expanded to:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">b</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
   <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>and then to:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">b</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> in an attribute will cause a
compilation error.  Example:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">attr</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">).</span>
</code></pre></div></div>

<p>The error message will look like this:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">example</span><span class="p">.</span><span class="nn">erl</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span> <span class="o">?</span><span class="nv">FUNCTION_NAME</span> <span class="n">can</span> <span class="n">only</span> <span class="n">be</span> <span class="n">used</span> <span class="n">within</span> <span class="n">a</span> <span class="n">function</span>
</code></pre></div></div>

<p>An invocation of <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> must not begin a
form.  Therefore, the following example is illegal:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>The error message will look like this:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">example</span><span class="p">.</span><span class="nn">erl</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span> <span class="o">?</span><span class="nv">FUNCTION_NAME</span> <span class="n">must</span> <span class="ow">not</span> <span class="k">begin</span> <span class="n">a</span> <span class="n">form</span>
</code></pre></div></div>

<h2 id="implementation-requirements">Implementation Requirements</h2>

<p>This EEP does not specify exactly how the <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and
<code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> macros should be implemented, but it does impose some
requirements on the implementation:</p>

<ul>
  <li>
    <p>The implementation must be efficient.  In particular, there should
not be any noticeable slowdowns for modules that don’t use the
<code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> macros.</p>
  </li>
  <li>
    <p>The expansion of <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> must be done
by the <code class="language-plaintext highlighter-rouge">epp</code> module.  Postponing expansion of the macros to a later
compiler pass is not acceptable, as it could cause compatibility
issues with parse transforms and other tools that operate on the
abstract format.</p>
  </li>
</ul>

<h2 id="examples">Examples</h2>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">FUNCTION_STRING</span><span class="p">,</span> <span class="nb">atom_to_list</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">)</span> <span class="o">++</span> <span class="s">"/"</span> <span class="o">++</span>
          <span class="nb">integer_to_list</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">)).</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">test</span><span class="p">()</span> <span class="o">-&gt;</span>
  <span class="o">?</span><span class="nv">FUNCTION_STRING</span><span class="p">.</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">test/0</code> function will return <code class="language-plaintext highlighter-rouge">"test/0"</code>.  Note that the
BEAM compiler will evaluate constant expressions at compilation time;
thus, <code class="language-plaintext highlighter-rouge">FUNCTION_STRING</code> will be turned into a string literal
during compilation.</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">c</span><span class="p">()</span> <span class="o">-&gt;</span>
  <span class="nv">F</span> <span class="o">=</span> <span class="k">fun</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="o">?</span><span class="nv">FUNCTION_NAME</span> <span class="k">end</span><span class="p">,</span>
  <span class="nv">F</span><span class="p">().</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">c/0</code> function will return <code class="language-plaintext highlighter-rouge">c</code>.</p>

<p>The macros can be used when creating a fun that refers to the
containing function:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">self_ref</span><span class="p">(</span><span class="nv">Data</span><span class="p">,</span> <span class="nv">Handler</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">...</span>
    <span class="nv">Handler</span><span class="p">(</span><span class="nv">Data</span><span class="p">,</span> <span class="k">fun</span> <span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="o">/?</span><span class="nv">FUNCTION_ARITY</span><span class="p">)</span>
    <span class="p">...</span>
</code></pre></div></div>

<h1 id="motivation">Motivation</h1>

<p>Many users have asked for some sort of macro that could return the
name of the current function, similar to <code class="language-plaintext highlighter-rouge">FILE</code>, <code class="language-plaintext highlighter-rouge">LINE</code>, and <code class="language-plaintext highlighter-rouge">MODULE</code>.
For example: <a href="http://erlang.org/pipermail/erlang-questions/2007-September/029387.html" title="Why no ?FUNCTION macro">Why no ?FUNCTION macro</a>.</p>

<p>The most common use case for a function name macro seems to be for
logging information to a log file.  Possible workarounds include using
a parse transform, using <code class="language-plaintext highlighter-rouge">process_info/2</code>, or generating and catching
an exception.  Unless the application needs a parse transform for some
other reason, implementing a parse transform just to catch the name of
the current function is cumbersome.  The other workarounds have
run-time penalties.</p>

<h1 id="rationale">Rationale</h1>

<h2 id="why-not-only-a-single-function-macro">Why not only a single <code class="language-plaintext highlighter-rouge">FUNCTION</code> macro?</h2>

<p>In order to minimize the pollution of the namespace of preprocessor
symbols, should there not be only a single <code class="language-plaintext highlighter-rouge">FUNCTION</code> macro that would
return a tuple with the name and arity of the current function?</p>

<p>It would certainly be possible, but many common use cases would be
somewhat cumbersome:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">"</span><span class="si">~p</span><span class="s">/</span><span class="si">~p</span><span class="s">: </span><span class="si">~s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">[</span><span class="nb">element</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION</span><span class="p">),</span>
                          <span class="nb">element</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION</span><span class="p">),</span>
                          <span class="nv">Message</span><span class="p">])</span>
</code></pre></div></div>

<p>Compare that to the more readable:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">"</span><span class="si">~p</span><span class="s">/</span><span class="si">~p</span><span class="s">: </span><span class="si">~s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">[</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span>
                          <span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">,</span>
                          <span class="nv">Message</span><span class="p">])</span>
</code></pre></div></div>

<p>There are also contexts where <code class="language-plaintext highlighter-rouge">element(1, ?FUNCTION)</code> or <code class="language-plaintext highlighter-rouge">element(2,
?FUNCTION)</code> would be illegal, for example in function heads or after
the <code class="language-plaintext highlighter-rouge">fun</code> keyword.  The following example would fail to compile:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nb">element</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION</span><span class="p">)</span><span class="o">/</span><span class="nb">element</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="why-do-i-have-to-define-function_string-myself">Why do I have to define <code class="language-plaintext highlighter-rouge">FUNCTION_STRING</code> myself?</h2>

<p>The most important reason is that there are <em>two</em> reasonable
definitions:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">FUNCTION_STRING</span><span class="p">,</span>
   <span class="nb">atom_to_list</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">)</span> <span class="o">++</span> <span class="s">"/"</span> <span class="o">++</span>
   <span class="nb">integer_to_list</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">)).</span>
</code></pre></div></div>

<p>and</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">FUNCTION_STRING</span><span class="p">,</span>
   <span class="o">?</span><span class="nv">MODULE_STRING</span> <span class="o">++</span> <span class="s">":"</span> <span class="o">++</span>
   <span class="nb">atom_to_list</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">)</span> <span class="o">++</span> <span class="s">"/"</span> <span class="o">++</span>
   <span class="nb">integer_to_list</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">)).</span>
</code></pre></div></div>

<p>There is no run-time penality for defining <code class="language-plaintext highlighter-rouge">FUNCTION_STRING</code>
yourself, as the compiler will turn either definition of
<code class="language-plaintext highlighter-rouge">FUNCTION_STRING</code> into a literal string during compilation.</p>

<p>Another reason is to avoid polluting the macro namespace with
more predefined macros than strictly needed.</p>

<p>Historical note: <code class="language-plaintext highlighter-rouge">MODULE_STRING</code> was added as an optimization in OTP
R7B, because at the time the compiler did not optimize constant
expressions as well as it does now.</p>

<h2 id="why-are-function_name-and-function_arity-allowed-in-function-heads">Why are <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> allowed in function heads?</h2>

<p>I cannot see any practical use for the <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and
<code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> macro in a function head.  Only allowing them to be
used in function bodies would make sense.  But consider this example:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
  <span class="n">ok</span><span class="p">;</span>
<span class="nf">f</span><span class="p">(</span><span class="o">?</span><span class="nv">FUNCTION_NAME</span><span class="p">,</span> <span class="o">?</span><span class="nv">FUNCTION_ARITY</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="n">ok</span><span class="p">.</span>
</code></pre></div></div>

<p>To be able to reject invocations of <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> and
<code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> in clauses other than the first, the preprocessor
must basically be able to parse arbitrary Erlang code.  The only
practical solution would be to use the existing parser in the
<code class="language-plaintext highlighter-rouge">erl_parse</code> module.  That would slow down the preprocessor without
providing any additional benefit.</p>

<h1 id="backwards-compatibility">Backwards Compatibility</h1>

<p>Modules that define either <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> will
fail to compile with a message similar to this:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">example</span><span class="p">.</span><span class="nn">erl</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span> <span class="n">redefining</span> <span class="n">predefined</span> <span class="n">macro</span> <span class="n">'FUNCTION_NAME'</span>
</code></pre></div></div>

<p>Similarly, attempting to define <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code>
from the command line using <code class="language-plaintext highlighter-rouge">-D</code> will also fail.</p>

<h1 id="implementation">Implementation</h1>

<p>The reference implementation has essentially zero extra cost for
functions that do not use the <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code>
macros.  The preprocessor will only start scanning to determine the
name and arity of the current function when an invocation of either
<code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> has been seen.  The scanning will
stop as soon as the right parenthesis at the end of the argument list
is found.  The name and arity will be saved and reused if another of
invocation of <code class="language-plaintext highlighter-rouge">FUNCTION_NAME</code> or <code class="language-plaintext highlighter-rouge">FUNCTION_ARITY</code> is seen in the same
function definition.</p>

<p>The reference implementation can be fetched from Github like this:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">git</span> <span class="n">fetch</span> <span class="nn">git</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">bjorng</span><span class="o">/</span><span class="n">otp</span><span class="p">.</span><span class="n">git</span> <span class="n">bjorn</span><span class="o">/</span><span class="n">function</span><span class="o">-</span><span class="n">macro</span>
</code></pre></div></div>

<h1 id="copyright">Copyright</h1>

<p>This document has been placed in the public domain.</p>


            </div>
        </div>
    </div>
</div>
<script src="/erlang-org/assets/js/prismjs/prism.js"></script>
<script src="/erlang-org/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/erlang-org/downloads.html" title="DOWNLOAD"><img src="/erlang-org/assets/img/download.png"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/erlang-org/assets/img/GitHub-Mark-32px.png"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/erlang-org/assets/img/twitter.png"
                    width="32"></a>
        </div>
    </footer>
    <script src="/erlang-org/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>