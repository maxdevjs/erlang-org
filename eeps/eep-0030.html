<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/erlang-org/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://erlang.github.io/erlang-org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0030 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0030 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://erlang.github.io/erlang-org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://erlang.github.io/erlang-org/blog.xml" />
    
    <link rel="stylesheet" href="/erlang-org/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/erlang-org/"><img
                    src="/erlang-org/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="post" action="https://duckduckgo.com/?kg=p"
                    onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' site:erlang.org'; return true;">
                    <input type="hidden" id="searchq" name="q" class="hidden" />
                    <input class="form-control me-2" id="searchfield" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Richard A. O&#39;Keefe &lt;ok(at)cs(dot)otago(dot)ac(dot)nz&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Final/R13A/R14A Proposal is implemented in OTP release R13A and R14A</dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>10-Jul-2008</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>R12B-4</dd>
                        
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                <h2 id="eep-30-maximum-and-minimum">EEP 30: Maximum and Minimum</h2>

<h1 id="abstract">Abstract</h1>

<p>Add maximum and minimum core functions.</p>

<h1 id="specification">Specification</h1>

<p>Currently the Erlang language has no built-in support for
the maximum and minimum operations.  So we add new functions</p>

<p><code class="language-plaintext highlighter-rouge">erlang:min(E1, E2)</code>  with the same effects and value as</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">T1</span> <span class="o">=</span> <span class="nv">E1</span><span class="p">,</span> <span class="nv">T2</span> <span class="o">=</span> <span class="nv">E2</span><span class="p">,</span> <span class="k">if</span> <span class="nv">T1</span> <span class="o">&gt;</span> <span class="nv">T2</span> <span class="o">-&gt;</span> <span class="nv">T2</span> <span class="p">;</span> <span class="n">true</span> <span class="o">-&gt;</span> <span class="nv">T1</span> <span class="k">end</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">erlang:max(E1, E2)</code>  with the same effects and value as</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">T1</span> <span class="o">=</span> <span class="nv">E1</span><span class="p">,</span> <span class="nv">T2</span> <span class="o">=</span> <span class="nv">E2</span><span class="p">,</span> <span class="k">if</span> <span class="nv">T1</span> <span class="o">&gt;</span> <span class="nv">T2</span> <span class="o">-&gt;</span> <span class="nv">T1</span> <span class="p">;</span> <span class="n">true</span> <span class="o">-&gt;</span> <span class="nv">T2</span> <span class="k">end</span><span class="p">)</span>
</code></pre></div></div>

<p>except that we expect them to be implemented using single VM
instructions, and we expect HiPE to use conditional moves on
machines that have them.</p>

<p>The <code class="language-plaintext highlighter-rouge">erlang:</code> module prefix on <code class="language-plaintext highlighter-rouge">max/2</code> (respectively <code class="language-plaintext highlighter-rouge">min/2</code>) can
be omitted if and only if there is no locally defind <code class="language-plaintext highlighter-rouge">max/2</code>
(respectively <code class="language-plaintext highlighter-rouge">min/2</code>).</p>

<h1 id="motivation">Motivation</h1>

<p>Maximum and minimum are extremely useful operations.
The fact that there is no standard way to express them in Erlang
has had the predictable result:  there are definitions of <code class="language-plaintext highlighter-rouge">max/2</code>
in <code class="language-plaintext highlighter-rouge">tool_utils</code>, <code class="language-plaintext highlighter-rouge">tv_pg_gridfcns</code>, <code class="language-plaintext highlighter-rouge">tv_pb</code>, <code class="language-plaintext highlighter-rouge">tv_comm_func</code>,
<code class="language-plaintext highlighter-rouge">ssh_connection_handler</code>, <code class="language-plaintext highlighter-rouge">bssh_connection_handler</code>, <code class="language-plaintext highlighter-rouge">ssh_cli</code>,
<code class="language-plaintext highlighter-rouge">hipe_arm</code>, <code class="language-plaintext highlighter-rouge">hipe_schedule</code>, <code class="language-plaintext highlighter-rouge">hipe_ultra_prio</code>, <code class="language-plaintext highlighter-rouge">hipe_ppc_frame</code>,
<code class="language-plaintext highlighter-rouge">?HIPE_X86_FRAME</code> (presumably one each for 32- and 64-bit PCs),
<code class="language-plaintext highlighter-rouge">hipe_sparc_frame</code>, <code class="language-plaintext highlighter-rouge">erl_recomment</code>, <code class="language-plaintext highlighter-rouge">erl_syntax_lib</code>, <code class="language-plaintext highlighter-rouge">appmon_info</code>,
oh, the list goes on and on.  There are dozens of copies.
There are nearly as many copies of <code class="language-plaintext highlighter-rouge">min/2</code>.  And that’s leaving
aside possible copies with different names.</p>

<p>Not only are the operations useful, they can be implemented
more efficiently by the compiler than by the programmer.
If <code class="language-plaintext highlighter-rouge">X &lt; Y</code> can be a VM instruction, so can <code class="language-plaintext highlighter-rouge">min</code> and <code class="language-plaintext highlighter-rouge">max</code>.
Here’s a first draft implementation:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">OpCase</span><span class="p">(</span><span class="n">i_minimum</span><span class="p">):</span> <span class="p">{</span>
    <span class="nf">r</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="nv">CMP_GT</span><span class="p">(</span><span class="n">tmp_arg1</span><span class="p">,</span> <span class="n">tmp_arg2</span><span class="p">))</span> <span class="o">?</span> <span class="n">tmp_arg1</span> <span class="p">:</span> <span class="n">tmp_arg2</span><span class="p">;</span>
    <span class="nv">Next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">OpCase</span><span class="p">(</span><span class="n">i_maximum</span><span class="p">):</span> <span class="p">{</span>
    <span class="nf">r</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="nv">CMP_GT</span><span class="p">(</span><span class="n">tmp_arg1</span><span class="p">,</span> <span class="n">tmp_arg2</span><span class="p">))</span> <span class="o">?</span> <span class="n">tmp_arg2</span> <span class="p">:</span> <span class="n">tmp_arg1</span><span class="p">;</span>
    <span class="nv">Next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Beware: untested code!  Amongst other things, I don’t know all the
places that need to be updated, or how, when new instructions are
added.  These instructions are intended to be preceded by an
<code class="language-plaintext highlighter-rouge">i_fetch</code> instruction the way &lt; and its other friends are.</p>

<p>This is much cheaper than an Erlang function call, and it’s much
easier for HiPE to recognise when a maximum or minimum of two
floating point numbers is involved and can be turned into a
compare and a conditional move.</p>

<p>The most important thing is the barrier to thought that is
removed.  When I’m writing Fortran, I know that max and min have
been there for decades, and I use those operations freely.
When I’m writing C, I know that those operations are not there,
and that there are problems with the conventional macros, so
I avoid them.  As an experiment, I added max() and min() functions
to the version of AWK that I maintain.  It was easy, and the
result is that I now have a lot of AWK code that can’t be run by
anything else, because the operations are so handy.  Erlang has
no <em>documented</em> maximum or minimum functions other than those in
the <code class="language-plaintext highlighter-rouge">lists</code> module, and writing <code class="language-plaintext highlighter-rouge">lists:max([X,Y])</code> is sufficiently
painful to deter all but the most determined.</p>

<h1 id="rationale">Rationale</h1>

<p>Function or operator?</p>

<p>I believe that there are excellent reasons to use the standard
<code class="language-plaintext highlighter-rouge">/\</code> and <code class="language-plaintext highlighter-rouge">\/</code> symbols from <a href="http://mathworld.wolfram.com/Lattice.html" title="Lattice Algebra">lattice</a> theory.  However, discussion in
the EEPs mailing list showed that the community was divided
into</p>

<ul>
  <li>people who were familiar with the operators</li>
  <li>people who insisted that they were only Boolean operators</li>
  <li>people who didn’t get them at all because they weren’t C.</li>
</ul>

<p>The ready availability of the operations as a standard part of
the language is much more important than what they are called,
so the second draft of this EEP switched to built in functions
in order to increase acceptance.</p>

<p>The argument which finally settled it for me was the
internationalisation one:  Japanese programmers may be using
keyboards where <code class="language-plaintext highlighter-rouge">\</code> means or screens where <code class="language-plaintext highlighter-rouge">\</code> displays as Yen,
so <code class="language-plaintext highlighter-rouge">/\</code> and <code class="language-plaintext highlighter-rouge">\/</code> just won’t work for them.</p>

<p>We cannot use <code class="language-plaintext highlighter-rouge">max</code> and <code class="language-plaintext highlighter-rouge">min</code> as operators because the compiler
will not let you use a symbol as both an operator and a function
name, and there are lots and lots of uses of <code class="language-plaintext highlighter-rouge">max</code> and <code class="language-plaintext highlighter-rouge">min</code> as
function names.  That’s precisely the problem we’re trying to
address here.  So they have to be function names.</p>

<p>There is no great difficulty in adding new functions to the
<code class="language-plaintext highlighter-rouge">erlang:</code> module.</p>

<p>I don’t want to write the <code class="language-plaintext highlighter-rouge">erlang:</code> prefix here.  There is
nothing new in making the <code class="language-plaintext highlighter-rouge">erlang:</code> prefix for some functions
optional either.</p>

<p>What we want is for existing modules with their own definitions
of <code class="language-plaintext highlighter-rouge">max/2</code> and/or <code class="language-plaintext highlighter-rouge">min/2</code> to remain legal, and then to be upgraded
simply by removing the redundant definitions.</p>

<p>Imagine that you want to find the bounding box for a set
of 2D points.  (This is adapted from code in Wings3D.)</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">bounding_box</span><span class="p">([{</span><span class="nv">X0</span><span class="p">,</span><span class="nv">Y0</span><span class="p">}|</span><span class="nv">Pts</span><span class="p">])</span> <span class="o">-&gt;</span>
    <span class="nf">bounding_box</span><span class="p">(</span><span class="nv">Pts</span><span class="p">,</span> <span class="nv">X0</span><span class="p">,</span><span class="nv">X0</span><span class="p">,</span> <span class="nv">Y0</span><span class="p">,</span><span class="nv">Y0</span><span class="p">).</span>

<span class="nf">bounding_box</span><span class="p">([{</span><span class="nv">X</span><span class="p">,</span><span class="nv">Y</span><span class="p">}|</span><span class="nv">Pts</span><span class="p">],</span> <span class="nv">Xlo</span><span class="p">,</span><span class="nv">Xhi</span><span class="p">,</span> <span class="nv">Ylo</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nv">X</span> <span class="o">&lt;</span> <span class="nv">Xlo</span> <span class="o">-&gt;</span> <span class="nv">Xlo1</span> <span class="o">=</span> <span class="nv">X</span><span class="p">,</span>   <span class="nv">Xhi1</span> <span class="o">=</span> <span class="nv">Xhi</span>
     <span class="p">;</span> <span class="nv">X</span> <span class="o">&gt;</span> <span class="nv">Xhi</span> <span class="o">-&gt;</span> <span class="nv">Xlo1</span> <span class="o">=</span> <span class="nv">Xlo</span><span class="p">,</span> <span class="nv">Xhi1</span> <span class="o">=</span> <span class="nv">X</span>
     <span class="p">;</span> <span class="n">true</span>    <span class="o">-&gt;</span> <span class="nv">Xlo1</span> <span class="o">=</span> <span class="nv">Xlo</span><span class="p">,</span> <span class="nv">Xhi1</span> <span class="o">=</span> <span class="nv">Xhi</span>
    <span class="k">end</span><span class="p">,</span>
    <span class="k">if</span> <span class="nv">Y</span> <span class="o">&lt;</span> <span class="nv">Ylo</span> <span class="o">-&gt;</span> <span class="nv">Ylo1</span> <span class="o">=</span> <span class="nv">Y</span><span class="p">,</span>   <span class="nv">Yhi1</span> <span class="o">=</span> <span class="nv">Yhi</span>
     <span class="p">;</span> <span class="nv">Y</span> <span class="o">&gt;</span> <span class="nv">Yhi</span> <span class="o">-&gt;</span> <span class="nv">Ylo1</span> <span class="o">=</span> <span class="nv">Ylo</span><span class="p">,</span> <span class="nv">Yhi1</span> <span class="o">=</span> <span class="nv">Y</span>
     <span class="p">;</span> <span class="n">true</span>    <span class="o">-&gt;</span> <span class="nv">Ylo1</span> <span class="o">=</span> <span class="nv">Ylo</span><span class="p">,</span> <span class="nv">Yhi1</span> <span class="o">=</span> <span class="nv">Yhi</span>
    <span class="k">end</span><span class="p">,</span>
    <span class="nf">bounding_box</span><span class="p">(</span><span class="nv">Pts</span><span class="p">,</span> <span class="nv">Xlo1</span><span class="p">,</span><span class="nv">Xhi1</span><span class="p">,</span> <span class="nv">Ylo1</span><span class="p">,</span><span class="nv">Yhi1</span><span class="p">);</span>
<span class="nf">bounding_box</span><span class="p">([],</span> <span class="nv">Xlo</span><span class="p">,</span><span class="nv">Xhi</span><span class="p">,</span> <span class="nv">Ylo</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{{</span><span class="nv">Xlo</span><span class="p">,</span><span class="nv">Ylo</span><span class="p">},</span> <span class="p">{</span><span class="nv">Xhi</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">}}.</span>
</code></pre></div></div>

<p>With maximum and minimum operators, this becomes</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">bounding_box</span><span class="p">([{</span><span class="nv">X</span><span class="p">,</span><span class="nv">Y</span><span class="p">}|</span><span class="nv">Pts</span><span class="p">],</span> <span class="nv">Xlo</span><span class="p">,</span><span class="nv">Xhi</span><span class="p">,</span> <span class="nv">Ylo</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nf">bounding_box</span><span class="p">(</span><span class="nv">Pts</span><span class="p">,</span> <span class="nf">min</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">Xlo</span><span class="p">),</span> <span class="nf">max</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">Xhi</span><span class="p">),</span>
    		  <span class="nf">min</span><span class="p">(</span><span class="nv">Y</span><span class="p">,</span><span class="nv">Ylo</span><span class="p">),</span> <span class="nf">max</span><span class="p">(</span><span class="nv">Y</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">));</span>
<span class="nf">bounding_box</span><span class="p">([],</span> <span class="nv">Xlo</span><span class="p">,</span><span class="nv">Xhi</span><span class="p">,</span> <span class="nv">Ylo</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{{</span><span class="nv">Xlo</span><span class="p">,</span><span class="nv">Ylo</span><span class="p">},</span> <span class="p">{</span><span class="nv">Xhi</span><span class="p">,</span><span class="nv">Yhi</span><span class="p">}}.</span>
</code></pre></div></div>

<h1 id="backwards-compatibility">Backwards Compatibility</h1>

<p>No issues.  Where a module already has <code class="language-plaintext highlighter-rouge">max/2</code> or <code class="language-plaintext highlighter-rouge">min/2</code>,
the <code class="language-plaintext highlighter-rouge">erlang:</code> prefix is required to get the new function.</p>

<h1 id="reference-implementation">Reference Implementation</h1>

<p>I don’t understand BEAM or the compiler well enough to
provide one, but the instruction definitions above are
offered as evidence that it should not be hard for those
who do.  If this EEP is accepted I will be happy to write
the documentation for these operators.</p>

<h1 id="copyright">Copyright</h1>

<p>This document has been placed in the public domain.</p>


            </div>
        </div>
    </div>
</div>
<script src="/erlang-org/assets/js/prismjs/prism.js"></script>
<script src="/erlang-org/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/erlang-org/downloads.html" title="DOWNLOAD"><img src="/erlang-org/assets/img/download.png"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/erlang-org/assets/img/GitHub-Mark-32px.png"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/erlang-org/assets/img/twitter.png"
                    width="32"></a>
        </div>
    </footer>
    <script src="/erlang-org/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>