<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/erlang-org/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://erlang.github.io/erlang-org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0054 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0054 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://erlang.github.io/erlang-org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://erlang.github.io/erlang-org/blog.xml" />
    
    <link rel="stylesheet" href="/erlang-org/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/erlang-org/"><img
                    src="/erlang-org/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="post" action="https://duckduckgo.com/?kg=p"
                    onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' site:erlang.org'; return true;">
                    <input type="hidden" id="searchq" name="q" class="hidden" />
                    <input class="form-control me-2" id="searchfield" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Bj√∂rn Gustavsson &lt;bjorn(at)erlang(dot)org&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Draft </dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>14-Sep-2020</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>24</dd>
                        
                        
                        <dt>Post-History:</dt>
                        <dd>14-Oct-2020, 27-Nov-2020</dd>
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                <h2 id="eep-54-provide-more-information-about-errors">EEP 54: Provide more information about errors</h2>

<h1 id="abstract">Abstract</h1>

<p>This EEP proposes a mechanism for reporting more human-readable
information about what went wrong when a BIF raises an exception.  The
same mechanism can be used by libraries or applications to provide
more detailed error messages.</p>

<h1 id="specification">Specification</h1>

<p>In OTP 23 and earlier, the shell prints a terse message when a call
to a built-in function (BIF) fails:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="o">&gt;</span> <span class="nb">element</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nb">element</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nb">element</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">bad argument</code> message informs us that one or more of the
arguments to the call were incorrect in some way (in this example,
both arguments have wrong types).</p>

<p>We propose a mechanism that enables the shell to print more helpful
error messages.  Here is how the message would be printed with the
reference implementation of this EEP:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="o">&gt;</span> <span class="nb">element</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nb">element</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nb">element</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">1</span><span class="p">:</span> <span class="ow">not</span> <span class="n">an</span> <span class="n">integer</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">2</span><span class="p">:</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">tuple</span>
</code></pre></div></div>

<p>Note that the exact formatting and phrasing of the messages is an implementation
detail outside the scope of this EEP.  What will be specified here are the APIs
and conventions that make these messages possible.</p>

<h3 id="proposals-in-this-eep">Proposals in this EEP</h3>

<ul>
  <li>
    <p>An extension of the format of the call-stack back trace (<strong>stacktrace</strong>) format
to indicate that there exists extended error information for that call, and
a convention for how extended error information can be provided.</p>
  </li>
  <li>
    <p>A new <code class="language-plaintext highlighter-rouge">erlang:error/3</code> BIF to allow libraries and applications to
raise an exception with extended error information in the stacktrace.</p>
  </li>
  <li>
    <p>New functions <code class="language-plaintext highlighter-rouge">erl_error:format_exception/3</code> and
<code class="language-plaintext highlighter-rouge">erl_error:format_exception/4</code> to allow libraries and applications to
format stacktraces in the same style as the shell.</p>
  </li>
</ul>

<h3 id="extending-the-stacktrace">Extending the stacktrace</h3>

<p>The stack back-trace (<strong>stacktrace</strong>) is currently a list of tuples.
For the purpose of this EEP we are only interested in the first entry
in the stacktrace.  It looks like
<code class="language-plaintext highlighter-rouge">{Module,Function,Arguments,ExtraInfo}</code>, where <code class="language-plaintext highlighter-rouge">ExtraInfo</code> is a list
of two-tuples.  As an indication that extended error info is available,
we propose adding an <code class="language-plaintext highlighter-rouge">{error_info,ErrorInfoMap}</code> tuple to <code class="language-plaintext highlighter-rouge">ExtraInfo</code>
in the first element in the stacktrace.</p>

<p>The map <code class="language-plaintext highlighter-rouge">ErrorInfoMap</code> may contain further information about the error
or hints on how to handle the error.</p>

<p>Currently, three optional keys have a defined meaning:</p>

<ul>
  <li>
    <p>The value of the key <code class="language-plaintext highlighter-rouge">module</code> is a module name of a module that
can be called to provide additional information about the error.
Default is <code class="language-plaintext highlighter-rouge">Module</code> from the stacktrace entry.</p>
  </li>
  <li>
    <p>The value of the key <code class="language-plaintext highlighter-rouge">function</code> is the name of the function to
be called in the module providing the error information. The
default name is <code class="language-plaintext highlighter-rouge">format_error</code>.</p>
  </li>
  <li>
    <p>The value of the key <code class="language-plaintext highlighter-rouge">cause</code>, if it exists, provides additional
information about the error.</p>
  </li>
</ul>

<p>To obtain more information about the error, the function named by the
values of the <code class="language-plaintext highlighter-rouge">module</code> and <code class="language-plaintext highlighter-rouge">function</code> keys can be called.  Hereafter
in this document, for brevity we will call that function
<code class="language-plaintext highlighter-rouge">format_error/2</code>.</p>

<p>The arguments for <code class="language-plaintext highlighter-rouge">format_error/2</code> are the exception reason (usually
<code class="language-plaintext highlighter-rouge">badarg</code> for BIF calls) and the stacktrace.</p>

<p>Thus, if a call to <code class="language-plaintext highlighter-rouge">element/2</code> fails with a <code class="language-plaintext highlighter-rouge">badarg</code> exception and the
first entry in the stacktrace is:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">erlang</span><span class="p">,</span><span class="nb">element</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="n">no_tuple</span><span class="p">],[{</span><span class="n">error_info</span><span class="p">,</span><span class="nv">ErrorInfoMap</span><span class="p">}]}</span>
</code></pre></div></div>

<p>and assuming that the stacktrace is bound to the variable
<code class="language-plaintext highlighter-rouge">StackTrace</code>, the following call will provide provide additional
information about the error:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">FormatModule</span> <span class="o">=</span> <span class="nn">maps</span><span class="p">:</span><span class="nb">get</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nv">ErrorInfoMap</span><span class="p">,</span> <span class="n">erlang</span><span class="p">),</span>
<span class="nv">FormatFunction</span> <span class="o">=</span> <span class="nn">maps</span><span class="p">:</span><span class="nb">get</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="nv">ErrorInfoMap</span><span class="p">,</span> <span class="n">format_error</span><span class="p">),</span>
<span class="nv">FormatModule</span><span class="p">:</span><span class="nv">FormatError</span><span class="p">(</span><span class="n">badarg</span><span class="p">,</span> <span class="nv">StackTrace</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">format_error/2</code> function should return a map.  For each argument
that was in error, there should be a map element with the argument number
as the key (that is, <code class="language-plaintext highlighter-rouge">1</code> for the first argument, <code class="language-plaintext highlighter-rouge">2</code> for the second, and so on)
and a <code class="language-plaintext highlighter-rouge">unicode:chardata()</code> term as the value.</p>

<p>The atoms <code class="language-plaintext highlighter-rouge">general</code> and <code class="language-plaintext highlighter-rouge">reason</code> can also be returned in the map.
<code class="language-plaintext highlighter-rouge">general</code> represents a generic error that is not attributed for a specific argument
(for example badarg of io:format(‚ÄúHello‚Äù) when the default device is dead).
<code class="language-plaintext highlighter-rouge">reason</code> will tell the error pretty printer to print the returned string instead
of the error reason. The value pointed to by <code class="language-plaintext highlighter-rouge">general</code> and <code class="language-plaintext highlighter-rouge">reason</code> should be
a <code class="language-plaintext highlighter-rouge">unicode:chardata()</code> term.</p>

<p>As an example:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">no_tuple</span><span class="p">],</span>
<span class="nv">StackTrace</span> <span class="o">=</span> <span class="p">[{</span><span class="n">erlang</span><span class="p">,</span> <span class="nb">element</span><span class="p">,</span> <span class="nv">Args</span><span class="p">,</span> <span class="p">[{</span><span class="n">error_info</span><span class="p">,</span><span class="nv">Map</span><span class="p">}]}],</span>
<span class="nn">erlang</span><span class="p">:</span><span class="nf">format_error</span><span class="p">(</span><span class="n">badarg</span><span class="p">,</span> <span class="nv">StackTrace</span><span class="p">)</span>
</code></pre></div></div>

<p>could return:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="p">{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"not a tuple"</span><span class="o">&gt;&gt;</span><span class="p">}</span>
</code></pre></div></div>

<p>And:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
<span class="nv">StackTrace</span> <span class="o">=</span> <span class="p">[{</span><span class="n">erlang</span><span class="p">,</span> <span class="nb">element</span><span class="p">,</span> <span class="nv">Args</span><span class="p">,</span> <span class="p">[{</span><span class="n">error_info</span><span class="p">,</span><span class="nv">Map</span><span class="p">}]}],</span>
<span class="nn">erlang</span><span class="p">:</span><span class="nf">format_error</span><span class="p">(</span><span class="n">badarg</span><span class="p">,</span> <span class="nv">Entry</span><span class="p">)</span>
</code></pre></div></div>

<p>could return:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="p">{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"out of range"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"not a tuple"</span><span class="o">&gt;&gt;</span><span class="p">}</span>
</code></pre></div></div>

<p>And:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Args</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Hello"</span><span class="p">],</span>
<span class="nv">StackTrace</span> <span class="o">=</span> <span class="p">[{</span><span class="n">io</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="nv">Args</span><span class="p">,</span> <span class="p">[{</span><span class="n">error_info</span><span class="p">,</span><span class="nv">Map</span><span class="p">}]}],</span>
<span class="nn">erlang</span><span class="p">:</span><span class="nf">format_error</span><span class="p">(</span><span class="n">badarg</span><span class="p">,</span> <span class="nv">Entry</span><span class="p">)</span>
</code></pre></div></div>

<p>could return:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="p">{</span><span class="n">general</span> <span class="o">=&gt;</span> <span class="s">"the device has terminated"</span><span class="p">}</span>
</code></pre></div></div>

<p>Note that the value for the key <code class="language-plaintext highlighter-rouge">cause</code>, if present, in the
<code class="language-plaintext highlighter-rouge">ErrorInfoMap</code> term is only to be used by <code class="language-plaintext highlighter-rouge">format_error/2</code>.  The
actual value for a particular error could change at any time.</p>

<p>The <code class="language-plaintext highlighter-rouge">cause</code> key will typically only be present when an error occurs
in a BIF that depends on the internal state in the runtime system
(such as <code class="language-plaintext highlighter-rouge">register/2</code> or the ETS BIFs), or for BIFs with complex
arguments (such as <code class="language-plaintext highlighter-rouge">system_flag/2</code>) that would make it tedious and
error prone to figure out which argument was in error.</p>

<p>Here is one way that <code class="language-plaintext highlighter-rouge">format_error/2</code> for the <code class="language-plaintext highlighter-rouge">erlang</code> module could
be implemented:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">format_error</span><span class="p">(</span><span class="nv">ExceptionReason</span><span class="p">,</span> <span class="p">[{</span><span class="n">erlang</span><span class="p">,</span> <span class="nv">F</span><span class="p">,</span> <span class="nv">As</span><span class="p">,</span> <span class="nv">Info</span><span class="p">}</span> <span class="p">|</span> <span class="p">_])</span> <span class="o">-&gt;</span>
    <span class="nv">ErrorInfoMap</span> <span class="o">=</span> <span class="nn">proplists</span><span class="p">:</span><span class="nf">get_value</span><span class="p">(</span><span class="n">error_info</span><span class="p">,</span> <span class="nv">Info</span><span class="p">,</span> <span class="err">#</span><span class="p">{}),</span>
    <span class="nv">Cause</span> <span class="o">=</span> <span class="nn">maps</span><span class="p">:</span><span class="nb">get</span><span class="p">(</span><span class="n">cause</span><span class="p">,</span> <span class="nv">ErrorInfoMap</span><span class="p">,</span> <span class="n">none</span><span class="p">),</span>
    <span class="nf">do_format_error</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">As</span><span class="p">,</span> <span class="nv">ExceptionReason</span><span class="p">,</span> <span class="nv">Cause</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">do_format_error</span><span class="p">(_,</span> <span class="p">_,</span> <span class="n">system_limit</span><span class="p">,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
    <span class="c">%% The explanation for system_limit is clear enough, so we don't
</span>    <span class="c">%% need any detailed explanations for the arguments.
</span>    <span class="err">#</span><span class="p">{};</span>
<span class="nf">do_format_error</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">As</span><span class="p">,</span> <span class="p">_,</span> <span class="nv">Cause</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nf">do_format_error</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">As</span><span class="p">,</span> <span class="nv">Cause</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">do_format_error</span><span class="p">(</span><span class="nb">element</span><span class="p">,</span> <span class="p">[</span><span class="nv">Index</span><span class="p">,</span> <span class="nv">Tuple</span><span class="p">],</span> <span class="p">_)</span> <span class="o">-&gt;</span>
    <span class="nv">Arg1</span> <span class="o">=</span> <span class="k">if</span>
               <span class="ow">not</span> <span class="nb">is_integer</span><span class="p">(</span><span class="nv">Index</span><span class="p">)</span> <span class="o">-&gt;</span>
                   <span class="o">&lt;&lt;</span><span class="s">"not an integer"</span><span class="o">&gt;&gt;</span><span class="p">;</span>
               <span class="nv">Index</span> <span class="o">=&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">Index</span> <span class="o">&gt;</span> <span class="nb">tuple_size</span><span class="p">(</span><span class="nv">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span>
                   <span class="o">&lt;&lt;</span><span class="s">"out of range"</span><span class="o">&gt;&gt;</span><span class="p">;</span>
               <span class="n">true</span> <span class="o">-&gt;</span>
                   <span class="p">[]</span>
           <span class="k">end</span><span class="p">,</span>
    <span class="nv">Arg2</span> <span class="o">=</span> <span class="k">if</span>
               <span class="ow">not</span> <span class="nb">is_tuple</span><span class="p">(</span><span class="nv">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"not a tuple"</span><span class="o">&gt;&gt;</span><span class="p">;</span>
               <span class="n">true</span> <span class="o">-&gt;</span> <span class="p">[]</span>
           <span class="k">end</span><span class="p">,</span>
    <span class="nv">PotentialErrors</span> <span class="o">=</span> <span class="p">[{</span><span class="mi">1</span><span class="p">,</span> <span class="nv">Arg1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="nv">Arg2</span><span class="p">}],</span>
    <span class="nn">maps</span><span class="p">:</span><span class="nf">from_list</span><span class="p">([{</span><span class="nv">ArgNum</span><span class="p">,</span> <span class="nv">Err</span><span class="p">}</span> <span class="p">||</span>
                       <span class="p">{</span><span class="nv">ArgNum</span><span class="p">,</span> <span class="nv">Err</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="nv">PotentialErrors</span><span class="p">,</span>
                       <span class="nv">Err</span> <span class="o">=/=</span> <span class="p">[]]);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">do_format_error</span><span class="p">(</span><span class="nb">list_to_atom</span><span class="p">,</span> <span class="p">_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
    <span class="err">#</span><span class="p">{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"not a flat list of characters"</span><span class="o">&gt;&gt;</span><span class="p">};</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">do_format_error</span><span class="p">(</span><span class="nb">register</span><span class="p">,</span> <span class="p">[</span><span class="nv">Name</span><span class="p">,</span><span class="nv">PidOrPort</span><span class="p">],</span> <span class="nv">Cause</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nv">Arg1</span><span class="p">,</span> <span class="nv">Arg2</span><span class="p">]</span> <span class="o">=</span>
    <span class="k">case</span> <span class="nv">Cause</span> <span class="k">of</span>
        <span class="n">registered_name</span> <span class="o">-&gt;</span>
            <span class="p">[[],</span><span class="o">&lt;&lt;</span><span class="s">"this process or port already has a name"</span><span class="o">&gt;&gt;</span><span class="p">];</span>
        <span class="n">notalive</span> <span class="o">-&gt;</span>
            <span class="p">[[],</span><span class="o">&lt;&lt;</span><span class="s">"the pid does not refer to an existing process"</span><span class="o">&gt;&gt;</span><span class="p">];</span>
        <span class="p">_</span> <span class="o">-&gt;</span>
            <span class="nv">Errors</span> <span class="o">=</span>
                <span class="p">[</span><span class="k">if</span>
                     <span class="nv">Name</span> <span class="o">=:=</span> <span class="n">undefined</span> <span class="o">-&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"'undefined' is not a valid name"</span><span class="o">&gt;&gt;</span><span class="p">;</span>
                     <span class="nb">is_atom</span><span class="p">(</span><span class="nv">Name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[];</span>
                     <span class="n">true</span> <span class="o">-&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"not an atom"</span><span class="o">&gt;&gt;</span>
                 <span class="k">end</span><span class="p">,</span>
                 <span class="k">if</span>
                     <span class="nb">is_pid</span><span class="p">(</span><span class="nv">PidOrPort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[];</span>
                     <span class="nb">is_port</span><span class="p">(</span><span class="nv">PidOrPort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[];</span>
                     <span class="n">true</span> <span class="o">-&gt;</span> <span class="o">&lt;&lt;</span><span class="s">"not a pid or a port"</span><span class="o">&gt;&gt;</span>
                 <span class="k">end</span><span class="p">],</span>
            <span class="k">case</span> <span class="nv">Errors</span> <span class="k">of</span>
                <span class="p">[[],[]]</span> <span class="o">-&gt;</span>
                    <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"name is in use"</span><span class="o">&gt;&gt;</span><span class="p">];</span>
                <span class="p">[_,_]</span> <span class="o">-&gt;</span>
                    <span class="nv">Errors</span>
            <span class="k">end</span><span class="p">,</span>
    <span class="nv">PotentialErrors</span> <span class="o">=</span> <span class="p">[{</span><span class="mi">1</span><span class="p">,</span> <span class="nv">Arg1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="nv">Arg2</span><span class="p">}],</span>
    <span class="nn">maps</span><span class="p">:</span><span class="nf">from_list</span><span class="p">([{</span><span class="nv">ArgNum</span><span class="p">,</span> <span class="nv">Err</span><span class="p">}</span> <span class="p">||</span>
                       <span class="p">{</span><span class="nv">ArgNum</span><span class="p">,</span> <span class="nv">Err</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="nv">PotentialErrors</span><span class="p">,</span>
                       <span class="nv">Err</span> <span class="o">=/=</span> <span class="p">[]]);</span>
      <span class="p">.</span>
      <span class="p">.</span>
      <span class="p">.</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">do_format_error</span><span class="p">(_,</span> <span class="p">_,</span> <span class="p">_)</span> <span class="o">-&gt;</span>
    <span class="err">#</span><span class="p">{}.</span>
</code></pre></div></div>

<p>Note that different strategies for different BIFS are used for
determining the extended error information:</p>

<ul>
  <li>
    <p>First the <code class="language-plaintext highlighter-rouge">system_limit</code> exception is handled (regardless of the
BIF that was called).  No extended error information is returned,
because the explanation for <code class="language-plaintext highlighter-rouge">system_limit</code> is sufficiently clear.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">element/2</code> failed, the <code class="language-plaintext highlighter-rouge">format_error/2</code> function only examines
the arguments for <code class="language-plaintext highlighter-rouge">element/2</code>.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">list_to_atom/1</code> raised a <code class="language-plaintext highlighter-rouge">badarg</code> exception, there is only one
possible error reason, so there is no need to examine the arguments.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">register/2</code> BIF fails, the value corresponding to the <code class="language-plaintext highlighter-rouge">cause</code>
key provides specific error reasons for two of the possible failure
reasons.  If the reason is not one of the two, <code class="language-plaintext highlighter-rouge">format_error/2</code> will
figure out the other reasons based on the arguments.</p>
  </li>
</ul>

<h3 id="supplying-extended-error-information-using-erlangerror3">Supplying extended error information using <code class="language-plaintext highlighter-rouge">erlang:error/3</code></h3>

<p>A library or application can raise an error exception with extended error
information by calling <code class="language-plaintext highlighter-rouge">erlang:error(Reason, Arguments, Options)</code>.
<code class="language-plaintext highlighter-rouge">Reason</code> should be the error reason (for example <code class="language-plaintext highlighter-rouge">badarg</code>), <code class="language-plaintext highlighter-rouge">Arguments</code>
should be arguments for the calling function, and <code class="language-plaintext highlighter-rouge">Options</code> should
be <code class="language-plaintext highlighter-rouge">[{error_info,ErrorInfoMap}]</code>.</p>

<p>The caller of <code class="language-plaintext highlighter-rouge">erlang:error/3</code> should provide a <code class="language-plaintext highlighter-rouge">format_error/2</code>
function (not necessarily with that name if the <code class="language-plaintext highlighter-rouge">ErrorInfoMap</code> has a
<code class="language-plaintext highlighter-rouge">function</code> key) that behaves as described in the previous section.</p>

<h3 id="formatting-stacktraces">Formatting stacktraces</h3>

<p>To make it possible for applications and libraries to format
stacktraces in the same style as the shell, the functions
<code class="language-plaintext highlighter-rouge">erl_error:format_exception/3</code> and <code class="language-plaintext highlighter-rouge">erl_error:format_exception/4</code> are
provided.  Here is an example how <code class="language-plaintext highlighter-rouge">erl_error:format_exception/3</code> can
be used:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span>
    <span class="p">.</span>
    <span class="p">.</span>
    <span class="p">.</span>
<span class="k">catch</span>
    <span class="nv">C</span><span class="p">:</span><span class="nv">R</span><span class="p">:</span><span class="nv">Stk</span> <span class="o">-&gt;</span>
        <span class="nv">Message</span> <span class="o">=</span> <span class="nn">erl_error</span><span class="p">:</span><span class="nf">format_exception</span><span class="p">(</span><span class="nv">C</span><span class="p">,</span> <span class="nv">R</span><span class="p">,</span> <span class="nv">Stk</span><span class="p">),</span>
        <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="nv">LogFile</span><span class="p">,</span> <span class="s">"~ts</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">[</span><span class="nv">Message</span><span class="p">])</span>
<span class="k">end</span><span class="p">.</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">erl_error:format_exception/4</code> function is similar but has a
fourth option argument to support customizing the message.  See the
documentation in the reference implementation for details.</p>

<h3 id="possible-future-extensions">Possible future extensions</h3>

<p>Since the <code class="language-plaintext highlighter-rouge">error_info</code> tuple in the stacktrace contains a map, more
data could be added to the map in future extension of this EEP.</p>

<p>Similarly, since the return value of <code class="language-plaintext highlighter-rouge">format_error/2</code> is a map,
additional keys in the map could be assigned a meaning in the future.</p>

<p>For example, the value for the key <code class="language-plaintext highlighter-rouge">hint</code> could be a longer message
that gives more context or provides concrete advice on how to
investigate or avoid the error.</p>

<h3 id="additional-examples">Additional examples</h3>

<p>Let‚Äôs look at some examples using ETS:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="o">&gt;</span> <span class="nv">T</span> <span class="o">=</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[]).</span>
<span class="err">#</span><span class="nv">Ref</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">2290824696</span><span class="p">.</span><span class="mi">4161404930</span><span class="p">.</span><span class="mi">5168</span><span class="o">&gt;</span>
<span class="mi">2</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nn">ets</span><span class="p">:</span><span class="n">update_counter</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="err">#</span><span class="nv">Ref</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">2290824696</span><span class="p">.</span><span class="mi">4161404930</span><span class="p">.</span><span class="mi">5168</span><span class="o">&gt;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">2</span><span class="p">:</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">key</span> <span class="n">that</span> <span class="n">exists</span> <span class="n">in</span> <span class="n">the</span> <span class="n">table</span>
</code></pre></div></div>

<p>Note that when an error occurs while evaluating an expression entered in the
shell, the evaluator process terminates and any ETS tables created by that
process are deleted.  Thus, calling <code class="language-plaintext highlighter-rouge">update_counter</code> a second time with the
same arguments results in a different message:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">3</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nn">ets</span><span class="p">:</span><span class="n">update_counter</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="err">#</span><span class="nv">Ref</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">2290824696</span><span class="p">.</span><span class="mi">4161404930</span><span class="p">.</span><span class="mi">5168</span><span class="o">&gt;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">1</span><span class="p">:</span> <span class="n">the</span> <span class="n">table</span> <span class="n">identifier</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">an</span> <span class="n">existing</span> <span class="nv">ETS</span> <span class="n">table</span>
</code></pre></div></div>

<p>Starting over, creating a new ETS table:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">4</span><span class="o">&gt;</span> <span class="nf">f</span><span class="p">(</span><span class="nv">T</span><span class="p">),</span> <span class="nv">T</span> <span class="o">=</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[]).</span>
<span class="err">#</span><span class="nv">Ref</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">2290824696</span><span class="p">.</span><span class="mi">4161404930</span><span class="p">.</span><span class="mi">5205</span><span class="o">&gt;</span>
<span class="mi">5</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">insert</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">}).</span>
<span class="n">true</span>
<span class="mi">6</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nn">ets</span><span class="p">:</span><span class="n">update_counter</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="err">#</span><span class="nv">Ref</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">2290824696</span><span class="p">.</span><span class="mi">4161404930</span><span class="p">.</span><span class="mi">5205</span><span class="o">&gt;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">3</span><span class="p">:</span> <span class="n">the</span> <span class="n">value</span> <span class="n">in</span> <span class="n">the</span> <span class="n">given</span> <span class="n">position</span> <span class="n">in</span> <span class="n">the</span> <span class="n">object</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">an</span> <span class="n">integer</span>
<span class="mi">7</span><span class="o">&gt;</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">bad</span><span class="p">).</span>
<span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nn">ets</span><span class="p">:</span><span class="n">update_counter</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nn">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p">(</span><span class="err">#</span><span class="nv">Ref</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">2290824696</span><span class="p">.</span><span class="mi">4161404930</span><span class="p">.</span><span class="mi">5205</span><span class="o">&gt;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">bad</span><span class="p">)</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">1</span><span class="p">:</span> <span class="n">the</span> <span class="n">table</span> <span class="n">identifier</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">an</span> <span class="n">existing</span> <span class="nv">ETS</span> <span class="n">table</span>
        <span class="o">***</span> <span class="n">argument</span> <span class="mi">3</span><span class="p">:</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">update</span> <span class="n">operation</span>
</code></pre></div></div>

<h1 id="motivation">Motivation</h1>

<p>When a call to a BIF fails with the reason <code class="language-plaintext highlighter-rouge">badarg</code> it is not always
obvious even to an experienced developer exactly which argument was
‚Äúbad‚Äù and in which way.  For a newcomer, having to figure out what a
<code class="language-plaintext highlighter-rouge">badarg</code> means is another stumbling block standing in the way of
mastering a new language.</p>

<p>Even for an experienced developer, figuring out the reason for a
<code class="language-plaintext highlighter-rouge">badarg</code> exception for some BIFs is hard or impossible.  For example,
<a href="http://erlang.org/doc/man/ets.html#update_counter-4">the documentation for <code class="language-plaintext highlighter-rouge">ets:update_counter/4</code></a> at the
time of writing lists 8 situations in which <code class="language-plaintext highlighter-rouge">ets:update_counter/4</code>
will fail. That number is too low.  Missing from list are, for
example, reasons such as the ETS table having been deleted or having
insufficient access right.</p>

<p>The <code class="language-plaintext highlighter-rouge">general</code> return key was added in order to allow information
to be given about the default I/O device in <a href="http://erlang.org/doc/man/io.html#format-1">io:format(‚Äúhello‚Äù)</a>.
It also allows third-party error_report implementations (such as Elixir)
much more freedom in what they can return.</p>

<p>The <code class="language-plaintext highlighter-rouge">reason</code> return key was added in order for third-party error_report
implementations (such as Elixir) to influence what is printed to describe
the actual error.</p>

<h1 id="rationale">Rationale</h1>

<h3 id="why-not-change-badarg-to-something-more-informational">Why not change <code class="language-plaintext highlighter-rouge">badarg</code> to something more informational?</h3>

<p>An alternative way to provide more information about errors would be
to introduce additional exception reasons.  For example, the call:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">element</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<p>could raise the exception:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">badarg</span><span class="p">,[{</span><span class="mi">1</span><span class="p">,</span><span class="n">not_integer</span><span class="p">},{</span><span class="mi">2</span><span class="p">,</span><span class="n">not_tuple</span><span class="p">}]}</span>
</code></pre></div></div>

<p>That change could break code that expects that BIFs should raise a
<code class="language-plaintext highlighter-rouge">badarg</code> exception.  It is less likely that existing code would match
the fourth entry in the stacktrace.</p>

<p>A related reason is the amount of work needed to revise the error
handling code for all built-in functions.  Implementing building of
Erlang terms in C is tedious and error prone.  There would always be a
risk that bugs in that code would crash the runtime system when an
error occurred.  The test suite would have to be extremely thorough
to ensure that all bugs were found, because error handling code is
typically infrequently executed.</p>

<h3 id="why-cant-the-stacktrace-contain-the-complete-error-reason">Why can‚Äôt the stacktrace contain the complete error reason?</h3>

<p>We did consider modifying the implementation of all BIFs so that they
would produce complete error information in the stacktrace when they
failed.  However, as mentioned earlier, building Erlang terms in C is
tedious and error prone.</p>

<p>With the approach we have taken to let Erlang code do most of the
analysis of the error reason, there is a much lower risk that error
handling would crash the application or runtime system.</p>

<h3 id="why-is-the-map-key-named-cause-and-not-reason">Why is the map key named <code class="language-plaintext highlighter-rouge">cause</code> and not <code class="language-plaintext highlighter-rouge">reason</code>?</h3>

<p>To avoid confusion with the exception reason.</p>

<h3 id="why-is-the-value-for-cause-in-the-errorinfomap-undocumented">Why is the value for <code class="language-plaintext highlighter-rouge">cause</code> in the <code class="language-plaintext highlighter-rouge">ErrorInfoMap</code> undocumented?</h3>

<p>The reason in the <code class="language-plaintext highlighter-rouge">ErrorInfoMap</code> is not meant to be used for
programmatically figuring out why an error occurred, but only to be used
by <code class="language-plaintext highlighter-rouge">Module:format_error/2</code> to produce a human-readable message.</p>

<p>Also, for many BIFs the <code class="language-plaintext highlighter-rouge">cause</code> key will not be present,
as the <code class="language-plaintext highlighter-rouge">Module:format/4</code> function will produce the messages
based solely on the name of the BIF and its arguments.</p>

<h3 id="how-is-the-module-key-useful">How is the <code class="language-plaintext highlighter-rouge">module</code> key useful?</h3>

<ul>
  <li>
    <p>In OTP all <code class="language-plaintext highlighter-rouge">format_error/2</code> functions will be in modules separate
from the implementing modules to facilitate reducing the size of OTP
in systems with tight storage constraints.  Having the <code class="language-plaintext highlighter-rouge">module</code>
key avoids the need for having a redirecting <code class="language-plaintext highlighter-rouge">format_error/2</code>
function in the implementing module.</p>
  </li>
  <li>
    <p>A library or application may want to have a single module that
implements <code class="language-plaintext highlighter-rouge">format_error/2</code> for multiple modules.  For example, in
OTP we might have the module <code class="language-plaintext highlighter-rouge">erl_stdlib_errors</code> that implements
<code class="language-plaintext highlighter-rouge">format_error/2</code> for the modules <code class="language-plaintext highlighter-rouge">binary</code>, <code class="language-plaintext highlighter-rouge">ets</code>, <code class="language-plaintext highlighter-rouge">lists</code>, <code class="language-plaintext highlighter-rouge">maps</code>,
<code class="language-plaintext highlighter-rouge">string</code>, and <code class="language-plaintext highlighter-rouge">unicode</code>.</p>
  </li>
</ul>

<h3 id="how-is-the-function-key-useful">How is the <code class="language-plaintext highlighter-rouge">function</code> key useful?</h3>

<ul>
  <li>
    <p>A module could already have a function named <code class="language-plaintext highlighter-rouge">format_error/2</code>.</p>
  </li>
  <li>
    <p>In the future we might want to extend the compiler to generate its
own <code class="language-plaintext highlighter-rouge">format_error/2</code> error function to provide more information
about <code class="language-plaintext highlighter-rouge">badmatch</code> or <code class="language-plaintext highlighter-rouge">function_clause</code> errors.</p>
  </li>
</ul>

<h1 id="backwards-compatibility">Backwards Compatibility</h1>

<p>All exceptions from BIFs will now have a <code class="language-plaintext highlighter-rouge">ExtraInfo</code> element (called
<code class="language-plaintext highlighter-rouge">Location</code> in the documentation for OTP 23) in the call-stack back
trace (stacktrace) that includes an <code class="language-plaintext highlighter-rouge">error_info</code> tuple.  In previous
releases the <code class="language-plaintext highlighter-rouge">ExtraInfo</code> element would be an empty list for a failed
BIF call.</p>

<p>Applications that explicitly do matching on the stacktrace and do
assumptions of the layout of the <code class="language-plaintext highlighter-rouge">ExtraInfo</code> element (for example,
assuming that <code class="language-plaintext highlighter-rouge">Location</code> is either an empty list or a list of <code class="language-plaintext highlighter-rouge">file</code>
and <code class="language-plaintext highlighter-rouge">line</code> tuples in a specific order) may need modifications.  Note
that such assumptions have never been safe and that the <a href="http://erlang.org/doc/reference_manual/errors.html#exceptions">documentation
for error handling</a> strongly discourages developers to rely on
stacktrace entries for purposes other than debugging.</p>

<h1 id="implementation">Implementation</h1>

<p>The reference implementation includes extended error information for
most BIFs implemented in C in the <code class="language-plaintext highlighter-rouge">erlang</code> and <code class="language-plaintext highlighter-rouge">ets</code> modules.
It can be found in <a href="https://github.com/erlang/otp/pull/2849">PR #2849</a>.</p>

<h1 id="copyright">Copyright</h1>

<p>This document has been placed in the public domain.</p>


            </div>
        </div>
    </div>
</div>
<script src="/erlang-org/assets/js/prismjs/prism.js"></script>
<script src="/erlang-org/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/erlang-org/downloads.html" title="DOWNLOAD"><img src="/erlang-org/assets/img/download.png"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/erlang-org/assets/img/GitHub-Mark-32px.png"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/erlang-org/assets/img/twitter.png"
                    width="32"></a>
        </div>
    </footer>
    <script src="/erlang-org/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>