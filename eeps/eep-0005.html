<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/erlang-org/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://erlang.github.io/erlang-org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0005 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0005 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://erlang.github.io/erlang-org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://erlang.github.io/erlang-org/blog.xml" />
    
    <link rel="stylesheet" href="/erlang-org/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/erlang-org/"><img
                    src="/erlang-org/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="post" action="https://duckduckgo.com/?kg=p"
                    onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' site:erlang.org'; return true;">
                    <input type="hidden" id="searchq" name="q" class="hidden" />
                    <input class="form-control me-2" id="searchfield" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Richard A. O&#39;Keefe &lt;ok(at)cs(dot)otago(dot)ac(dot)nz&gt;
                            
                            , 
                            
                            
                            Per Gustafsson &lt;pergu(at)it(dot)uu(dot)se&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Draft </dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>10-Aug-2007</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>R12B-0</dd>
                        
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                <h2 id="eep-5-more-versatile-encapsulation-with-export_to">EEP 5: More Versatile Encapsulation with <code class="language-plaintext highlighter-rouge">export_to</code></h2>

<h1 id="abstract">Abstract</h1>

<p>This EEP describes a new directive called <code class="language-plaintext highlighter-rouge">export_to</code> which allows a
module to specify exactly which other modules that can call a function
defined in the module. This provides a very fine grained primitive for
encapsulation. Allowing the programmer to control more directly how
his code should be used.</p>

<p>This is an idea originally proposed by Richard O’Keefe.</p>

<h1 id="specification">Specification</h1>

<p>This is the syntax for the <code class="language-plaintext highlighter-rouge">-export_to</code> directive:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">export_to</span><span class="p">([</span><span class="n">m</span><span class="p">,...],</span> <span class="p">[</span><span class="n">f</span><span class="o">/</span><span class="n">a</span><span class="p">,...]).</span>
</code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">[m,...]</code> is a list of module names and ``[f/a,…]’’
is a list of function name/arity pairs.</p>

<p>This means that the function <code class="language-plaintext highlighter-rouge">f/a</code> can be called from the module
<code class="language-plaintext highlighter-rouge">m</code>. Whether the call is a static call, a dynamic call,
or an apply should not matter.</p>

<p>Except for the restriction to a specified set of modules,
these functions should act like functions exported to the
world using <code class="language-plaintext highlighter-rouge">-export</code>, <em>i</em>.<em>e</em>., calls to these functions
should always invoke the latest version of the function.</p>

<p>When a list has only one element, it may be abbreviated to just
that element, so</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">export_to</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="o">/</span><span class="n">a</span><span class="p">,...]).</span>
<span class="p">-</span><span class="ni">export_to</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">f</span><span class="o">/</span><span class="n">a</span><span class="p">).</span>
<span class="p">-</span><span class="ni">export_to</span><span class="p">([</span><span class="n">m</span><span class="p">,...],</span> <span class="n">f</span><span class="o">/</span><span class="n">a</span><span class="p">).</span>
</code></pre></div></div>

<p>are allowed abbreviations.</p>

<p>A function may be explicitly exported to any number of modules.
An Erlang compiler should allow a function to be both explicitly
exported to one or more modules with <code class="language-plaintext highlighter-rouge">-export_to</code> and also
exported to the world with <code class="language-plaintext highlighter-rouge">-export</code>, in order to ease the
transition, but should by default warn about this.
The existing <code class="language-plaintext highlighter-rouge">export_all</code> flag should also be compatible with
explicit exports.</p>

<h1 id="motivation">Motivation</h1>

<p>Modules in Erlang have several roles.
A module is the unit of compilation and code reloading.
It is also the unit of encapsulation, because the
only way to hide a function from being called by any other function is
to make it a local function in a module.  A module also defines a
separate namespace for functions.  This wealth of roles for the module
makes it difficult to structure Erlang applications in a way that
makes them well encapsulated while keeping modules small and focused.</p>

<p>Most applications written in Erlang consist of several smaller
modules, and though the application has a public API which is a subset
of the exported functions of the modules, exactly which functions
are part of the public API can only be specified in comments or
documentation since functions are either exported so that anyone can
call them, or not exported meaning that they can only be called inside
the module, but sometimes we want to have more control than
this, <em>e</em>.<em>g</em>., this function should only be called from other modules
in this application,
or this function should only be called from the shell.</p>

<p>The <code class="language-plaintext highlighter-rouge">-export_to</code> directive lets the programmer
express such restrictions, which the runtime system then enforces,
so that readers can trust them.
The <code class="language-plaintext highlighter-rouge">-export_to</code> directive is <strong>not</strong> meant to replace
the <code class="language-plaintext highlighter-rouge">-export</code> directive, but to be an alternative when the
programmer knows all intended collaborators.</p>

<p>This feature was originally inspired by the way the programming
language Eiffel controls the visibility of a class’s features
to other classes, so Bertrand Meyer deserves the credit.  This
means, of course, that the idea is “proven technology”.</p>

<h1 id="rationale">Rationale</h1>

<p>There are some choices in designing the <code class="language-plaintext highlighter-rouge">-export_to</code> syntax,
for example should m be allowed to be a list of modules or
should we have an <code class="language-plaintext highlighter-rouge">export_to</code> list where each entry is a module,
function/arity pair.
One reason to use the suggested syntax is that it reads pretty easily as:</p>

<p>export to module <code class="language-plaintext highlighter-rouge">m</code> this list of functions <code class="language-plaintext highlighter-rouge">[f/a]</code></p>

<p>One way to think about this is that there is an “export” matrix
where the rows are indexed by modules and the columns are indexed
by local functions.  Sometimes it is convenient to slice it by
rows (<em>this</em> behaviour module may call <em>these</em> callbacks) and
sometimes it is convenient to slice it by columns (<em>this</em> utility
function may be called by all <em>these</em> modules in my application).
The original design focus was on callbacks so that they could be
exported to a behaviour without exporting them to the world.
Since then it has become clear that exporting to an application
is also a convenient thing.  So let us allow programmers to write
the matrix whatever way most clearly expresses their intentions.</p>

<p>Another issue is whether we should have some syntactic sugar for
specifying common export patterns such as exporting a set of functions
to all the modules in an application or exporting a function in order
to make it possible to apply the function or to make it possible to
update the code of the function.</p>

<p>In fact exporting to an application is already easy with this
proposal.  When you develop an application <em>foo</em>, create a
file <em>foo</em><code class="language-plaintext highlighter-rouge">_modules.hrl</code> with the contents:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">_FOO_</span><span class="err">`</span><span class="p">_</span><span class="nv">MODULES</span><span class="err">`</span><span class="p">,</span>
        <span class="p">[</span> <span class="n">mod1</span>
        <span class="p">,</span> <span class="n">mod2</span>
        <span class="p">...</span>
        <span class="p">]).</span>
        
</code></pre></div></div>
<p>Then within a file you may write</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">include</span><span class="p">(</span><span class="n">'_foo_`_modules.hrl'</span><span class="p">).</span>
<span class="p">-</span><span class="ni">export_to</span><span class="p">(_</span><span class="nv">FOO_</span><span class="err">`</span><span class="p">_</span><span class="nv">MODULES</span><span class="err">`</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="o">/</span><span class="n">a</span><span class="p">,...]).</span>
</code></pre></div></div>

<p>Further additions to this proposal may be worth discussing once
we have some experience with this basic building block.</p>

<p>One issue which perhaps deserves comment is that <em>calling</em> a
restricted-export function is just like any other remote call.
These seems to be no reason to make it different.  In particular,
if module A initially exports a function to the world, and
module B calls it, and then the author of module A decides to
restrict it to B, B should not change.</p>

<h1 id="backwards-compatibility">Backwards Compatibility</h1>

<p>Adding an <code class="language-plaintext highlighter-rouge">-export_to</code> directive should be totally backwards
compatible, because since it is not a legal attribute, it currently
causes a syntax error.</p>

<h1 id="implementation">Implementation</h1>

<p>This feature has not been implemented yet, but here are some goals
that we think the implementation should fulfill:</p>

<ul>
  <li>
    <p>Ordinary static calls to an <code class="language-plaintext highlighter-rouge">-export_to</code> function should cost the
same as calls to other <code class="language-plaintext highlighter-rouge">-export_to</code> functions.</p>
  </li>
  <li>
    <p>The performance of other calls should not be affected by the
introduction of <code class="language-plaintext highlighter-rouge">-export_to</code> calls.</p>
  </li>
  <li>
    <p>The space cost should be O(1) per (m,f,a) matrix entry.</p>
  </li>
</ul>

<p>These can be archived by putting most of the machinery to handle this
feature in the loader and only using dynamic checks for dynamic
calls.</p>


            </div>
        </div>
    </div>
</div>
<script src="/erlang-org/assets/js/prismjs/prism.js"></script>
<script src="/erlang-org/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/erlang-org/downloads.html" title="DOWNLOAD"><img src="/erlang-org/assets/img/download.png"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/erlang-org/assets/img/GitHub-Mark-32px.png"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/erlang-org/assets/img/twitter.png"
                    width="32"></a>
        </div>
    </footer>
    <script src="/erlang-org/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>