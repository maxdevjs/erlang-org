<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Allow pinning of website on windows -->
    <meta name="application-name" content="Erlang.org">
    <meta name="msapplication-tooltip" content="The official home of the Erlang Programming Language">
    <meta name="msapplication-starturl" content="/erlang-org/" >

    <!-- Make the site look nicer on facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Erlang.org">
    <meta property="og:title" content="Welcome to Erlang.org">
    <meta property="og:description" content="The official home of the Erlang Programming Language">
    <meta property="og:image" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:image:secure_url" content="https://erlang.github.io/erlang-org/assets/img/erlang-228x200.png">
    <meta property="og:url" content="https://erlang.github.io/erlang-org/">

    <!-- Twitter metadata -->
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Index" />
    <meta name="twitter:site" content="@erlang_org" />

    <!-- Rich data for google search -->
    <script type="application/ld+json">
{"@type":"WebSite","url":"https://erlang.org/","headline":"Eep 0021 - Erlang/OTP","name":"Erlang.org","sameAs":["https://twitter.com/erlang_org","https://github.com/erlang/otp"],"@context":"https://schema.org"}</script>

    <title>Eep 0021 - Erlang/OTP</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- tells iOS browsers to not show telephone numbers as links -->
    <meta name="format-detection" content="telephone=no">

    <meta name="application-name" content="Erlang.org">
    <meta name="description" content="The official home of the Erlang Programming Language">
    <meta name="keywords" content="Erlang programming language functional parallel distributed documentation download community">
    <!-- https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/atom+xml" title="News Atom Feed" href="https://erlang.github.io/erlang-org/news.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Atom Feed" href="https://erlang.github.io/erlang-org/blog.xml" />
    
    <link rel="stylesheet" href="/erlang-org/assets/css/main.css">
</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-body">
        <nav class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/erlang-org/"><img
                    src="/erlang-org/assets/img/erlang.png" class="img-fluid" width="60" alt="Erlang.org main page"/></a>
            <div class="collapse navbar-collapse fw-bold" id="navbarSupportedContent">
                <ul class="navbar-nav text-uppercase me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/downloads">Download</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/docs">Documentation</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/community">Community</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/news">News</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/eep">EEP</a></li>
                    <li class="nav-item"><a class="nav-link" href="/erlang-org/about">About</a></li>
                </ul>
                <form class="d-flex" role="search" method="post" action="https://duckduckgo.com/?kg=p"
                    onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' site:erlang.org'; return true;">
                    <input type="hidden" id="searchq" name="q" class="hidden" />
                    <input class="form-control me-2" id="searchfield" type="search" placeholder="Search erlang.org"
                        aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
            </div>
        </nav>
    </header>
    <div class="container border-top pt-4">
    <div class="row-lg">
        <div class="col-lg-10 offset-lg-1">
            <div class="card">
                <div class="card-body">
                    <dl class="mb-0 dl-single">
                        <dt>Author:</dt>
                        <dd>
                            Richard A. O&#39;Keefe &lt;ok(at)cs(dot)otago(dot)ac(dot)nz&gt;
                            
                            
                        </dd>
                        
                        <dt>Status:</dt>
                        <dd>Draft </dd>
                        <dt>Type:</dt>
                        <dd>Standards Track</dd>
                        
                        
                        <dt>Created:</dt>
                        <dd>08-Aug-2008</dd>
                        
                        <dt>Erlang-Version:</dt>
                        <dd>R12B-4</dd>
                        
                        
                        
                        
                    </dl>
                </div>
            </div>
            <div class="border-top mt-4">
                <h2 id="eep-21-optional-trailing-commas-for-lists-and-tuples">EEP 21: Optional trailing commas for lists and tuples</h2>

<h1 id="abstract">Abstract</h1>

<p>Allow an extra comma at the end of a list or tuple.
Darren New proposed this change; Richard O’Keefe, who doesn’t
like it very much, wrote it up as an EEP.</p>

<h1 id="specification">Specification</h1>

<p>A list that would have ended with “,X]” for some term X
may instead end with “,X,]”.
A tuple that would have ended with “,X}” for some term X
may instead end with “,X,}”.
The rule for tuples also applies to records and -record
declarations.</p>

<h1 id="motivation">Motivation</h1>

<p>About 5,000 lines of the Erlang/OTP sources begin with a right
square bracket or right curly brace.  For example, -record
declarations are commonly laid out as</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">foo</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">field_1</span> <span class="o">=</span> <span class="n">default_1</span><span class="p">,</span>
    <span class="p">...</span>
    <span class="n">field_n</span> <span class="o">=</span> <span class="n">default_n</span>
 <span class="p">}).</span>
</code></pre></div></div>

<p>e.g.,</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">hostent</span><span class="p">,</span> <span class="p">{</span>
	 <span class="n">h_name</span><span class="p">,</span>
	 <span class="n">h_aliases</span> <span class="o">=</span> <span class="p">[],</span>
	 <span class="n">h_addrtype</span><span class="p">,</span>
	 <span class="n">h_length</span><span class="p">,</span>
	 <span class="n">h_addr_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="p">}).</span>
</code></pre></div></div>

<p>and record creation expressions are often laid out similarly, e.g.,</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">make_hostent</span><span class="p">(</span><span class="nv">Name</span><span class="p">,</span> <span class="nv">Addrs</span><span class="p">,</span> <span class="nv">Aliases</span><span class="p">,</span> <span class="o">?</span><span class="nv">S_A</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nl">#hostent</span> <span class="p">{</span>
    	  <span class="n">h_name</span>      <span class="o">=</span> <span class="nv">Name</span><span class="p">,</span>
    	  <span class="n">h_addrtype</span>  <span class="o">=</span> <span class="n">inet</span><span class="p">,</span>
    	  <span class="n">h_length</span>    <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    	  <span class="n">h_addr_list</span> <span class="o">=</span> <span class="nv">Addrs</span><span class="p">,</span>
    	  <span class="n">h_aliases</span>   <span class="o">=</span> <span class="nv">Aliases</span>
    	 <span class="p">};</span>
</code></pre></div></div>

<p>Adding entries to such lists (in the informal sense of “list”),
removing entries, and reordering entries would be simpler if they
were all punctuated the same way.  Lists (in the Erlang sense of
“list”) of options are also often laid out like this.</p>

<p>C, C++, Java, and Javascript allow a trailing comma in
initial value lists.  Python allows trailing commas in lists and
dictionaries.  Python in particular is evidence that a programming
language can support this feature without charges of “C envy” or
of extreme ugliness.</p>

<h1 id="rationale">Rationale</h1>

<p>I don’t actually feel any need for this proposal; I believe that
the answer is better tool support.  However, many people are
wedded to their tools, even more than their programming languages.
Darren New is not the only one to have asked for it, and with
about 1 SLOC in 110 of the Erlang/OTP sources reflecting a list or
tuple where this feature could have been used, it’s very much a
low cost high public appreciation feature.</p>

<p>I wrote that last sentence before working on the parser to make it
accept this “feature”.  There are 115 lines of plain diffs.  I
could have made this change to the Prolog parser in 10 minutes,
but then the Prolog parser has the enormous advantage of NOT being
written using an LR parser generator like Yecc.  Still, now that I
<em>have</em> hacked on the parser, the cost to everyone <em>else</em> is low.</p>

<p>The specification was carefully worded.  Commas are NOT allowed in
empty lists or tuples, nor in list or tuple comprehensions.  They
are only allowed after a final element, so <code class="language-plaintext highlighter-rouge">[1|L,]</code> is also not
allowed.  Nor are trailing commas allowed inside argument lists,
only in <code class="language-plaintext highlighter-rouge">[]</code> and <code class="language-plaintext highlighter-rouge">{}</code>.  They are, however, allowed in tuple and
record types.</p>

<p>This is very similar to the “optional semicolons” EEP (which was
FAR simpler to implement).  The heart and soul of that EEP is the
desire to make semicolons and commas look DIFFERENT; for this
reason it is important NOT to allow optional trailing semicolons.
If semicolons may trail, commas must not.
If commas may trail, semicolons must not.
It is also important NOT to approach the “consistent punctuation
for list elements” problem by allowing optional leading commas.
If semicolons may lead, commas must not.
If commas may lead, semicolons must not.
Since trailing commas are established practice in C, C++, Java,
ECMAScript, Python, &amp;c, commas trail, semicolons lead.</p>

<p>I repeat that this is not my idea.  I’ve just written up the EEP
and figured out how to implement it.  With nearly 1% of the SLOC
in the Erlang/OTP system being cases where people might well have
had reason to add a trailing comma, had it been legal, it seemed
worth while finding out whether it would be practical.</p>

<h1 id="backwards-compatibility">Backwards Compatibility</h1>

<p>All existing Erlang code remains acceptable with unchanged
semantics.  The commas are dealt with entirely in the parser;
other language manipulation tools never know that they were
there, so work perfectly with code using them.</p>

<h1 id="reference-implementation">Reference Implementation</h1>

<p>The auxiliary file <a href="eep-0021-1.diff" title="Patch for erl_parse.yrl">eep-0021-1.diff</a>
is a patch file to be applied to <code class="language-plaintext highlighter-rouge">erl_parse.yrl</code>.</p>

<p>You would think that all we’d need to do would be to change</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span> <span class="n">']'</span>                    <span class="p">...</span> <span class="n">'}'</span>
</code></pre></div></div>

<p>to</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span> <span class="n">','</span> <span class="n">']'</span>                <span class="p">...</span> <span class="n">','</span> <span class="n">'}'</span>
</code></pre></div></div>

<p>in several places.  You would be wrong.  With a different grammar,
maybe.  With the current grammar, this was an uncommonly tricky
change requiring surgery in all sorts of places.  The result gets
through Yecc with no complaints other than the two shift/reduce
complaints that are expected (and have nothing to do with this change).</p>

<h1 id="copyright">Copyright</h1>

<p>This document has been placed in the public domain.</p>


            </div>
        </div>
    </div>
</div>
<script src="/erlang-org/assets/js/prismjs/prism.js"></script>
<script src="/erlang-org/assets/js/prismjs/components/prism-erlang.js"></script>
    <footer class="container-fluid footer text-center border-top border-bottom">
        <div>
            <a href="/erlang-org/downloads.html" title="DOWNLOAD"><img src="/erlang-org/assets/img/download.png"></a>
        </div>
        <div>
            <a href="http://www.github.com/erlang/otp"><img
                    src="/erlang-org/assets/img/GitHub-Mark-32px.png"></a>
        </div>
        
        <div>
            <a href="http://www.twitter.com/erlang_org"><img src="/erlang-org/assets/img/twitter.png"
                    width="32"></a>
        </div>
    </footer>
    <script src="/erlang-org/assets/js/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>